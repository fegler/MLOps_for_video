<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Video Stream Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
  </head>
  <body>
    <div>
      <input type="file" id="videoInput" />
      <div id="stream"></div>
      <script>
        var socket = io.connect();

        socket.on("connect", function () {
          console.log("Connected!");
        });

        socket.on("stream_data", function (data) {
          console.log("stream data received");
          const canvas = document.getElementById("stream_canvas");
          const ctx = canvas.getContext("2d");
          const base64_frame = btoa(
            String.fromCharCode(...new Uint8Array(data.stream_frame))
          );
          const img = new Image();
          img.onload = function () {
            ctx.drawImage(img, 0, 0);
          };
          img.src = `data:image/jpeg;base64,${base64_frame}`;
          // console.log(img.src);
        });

        function handleVideoUpload(event) {
          const stream_div = document.getElementById("stream");
          const canvas = document.createElement("canvas");
          canvas.id = "stream_canvas";
          stream_div.appendChild(canvas);
          const file = event.target.files[0];
          socket.emit("process_video", file);
        }

        const videoInput = document.getElementById("videoInput");
        videoInput.addEventListener("change", handleVideoUpload);
      </script>
    </div>
  </body>
</html>
